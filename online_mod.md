# online_mod.js (StreamHub simplified)

Текущая версия плагина для Lampa, лежит в `adapters/lampa-adapter/static/online_mod.js`.

## Что умеет
- Одна кнопка «Онлайн» на карточке (`.view--online_streamhub`).
- Отдельные сценарии для фильмов и сериалов:
  - Фильм: сразу запрашивает стримы и показывает список.
  - Сериал: сначала список сезонов (из TMDB), затем серии выбранного сезона; после выбора серии – список стримов.
- Проигрывание: Enter по стриму → `Lampa.Player.play` и плейлист из одного элемента.
- Кнопка «← Назад» в списке стримов возвращает к сериям текущего сезона.
- Долгих меню, балансеров, RCH и истории нет — минимальный потоковый слой.

## Где берёт данные
- Потоки: `GET /streams` на том же хосте, что отдал `online_mod.js`. Параметры: imdb, query (title/name), season, episode.
- Сезоны/серии: TMDB API через `Lampa.Api.sources.tmdb` (`tv/{id}`, `tv/{id}/season/{n}`).
- Сейчас в коде включён mock: вместо реального вызова `/streams` возвращает два фиктивных стрима (1080p, 720p) для быстрой проверки UI.

## Поток выполнения
1. Старт плагина: регистрирует локализацию, шаблоны, компонент; слушает `full:complite` и вставляет кнопку перед `.button--play`.
2. По Enter по кнопке: создаёт Activity `wtch_online` с данными карточки (учитывает `Activity.active().method === 'tv'` и `active.card`).
3. В компоненте `start`:
   - если фильм → `loadStreams()` → показывает список стримов;
   - если сериал → `showSeasons()` → `loadEpisodes(season)` → `drawStreams()`.
4. `drawStreams` строит простой список карточек (title + meta «качество/источник») и кнопку назад.

## Шаблоны/CSS
- `wtch_simple_item`, `wtch_empty` и минимальный CSS подключаются один раз при загрузке плагина (без условий).

## Ограничения
- Нет балансеров/голосов, таймлайнов, историй просмотров.
- Пока заглушка по стримам (mock). Для подключения бэкенда нужно заменить блок mock в `loadStreams` на `fetchStreams(payload)`.

## Файлы и эндпоинты
- Плагин: `adapters/lampa-adapter/static/online_mod.js` (отдаётся по `GET /online_mod.js`).
- Потоки: `GET /streams` (см. адаптер `src/index.ts`).
